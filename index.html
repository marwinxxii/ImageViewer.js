<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <title>Gallery</title>
        <style>
            img
            {
                max-width: 100%;
                max-height: 100%;
            }
            #gallery
            {
                text-align: center;
            }
            .hidden
            {
                display: none;
            }
        </style>
    </head>
    <body>
        <div id="control">
            <input id="files" type="file" multiple>
            <input id="fullscreen" type="button" value="Full screen">
        </div>
        <div id="gallery"></div>
        <script>
            var gallery = {
                index: null,
                element: null,
                size: 0
            };

            function onFilesSelected()
            {
                if (!this.files || this.files.length == 0) return;
                gallery.element.innerHTML = '';
                var reader;
                for (var i = 0; i < this.files.length; i++)
                {
                    reader = new FileReader();
                    reader.onload = (function(index){
                        return function(e)
                        {
                            var img = document.createElement('img');
                            if (index != 0) {
                                img.className = 'hidden';
                            }
                            img.src = e.target.result;
                            gallery.element.appendChild(img);
                        }
                    })(i);
                    reader.readAsDataURL(this.files[i]);
                }
                gallery.size = this.files.length;
                gallery.element.addEventListener('click',
                    showNextImage, false);
                gallery.index = 0;
            }

            function showNextImage()
            {
                var imgs = gallery.element.getElementsByTagName('img');
                imgs[gallery.index].className = 'hidden';
                gallery.index = (gallery.index + 1) % gallery.size;
                imgs[gallery.index].className = '';
            }

            function showPreviousImage()
            {
                var imgs = gallery.element.getElementsByTagName('img');
                imgs[gallery.index].className = 'hidden';
                if (gallery.index == 0)
                    gallery.index = gallery.size - 1;
                else
                    gallery.index -= 1;
                imgs[gallery.index].className = '';
            }

            function requestFullScreen(elem)
            {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                }
            }

            function startFullscreen()
            {
                requestFullScreen(gallery.element);
            }

            function onKeyPress(e)
            {
                var SPACE = 32, ARROW_RIGHT = 39, ARROW_LEFT = 37;
                if (e.keyCode == SPACE || e.keyCode == ARROW_RIGHT)
                {
                    showNextImage(e);
                }
                else if (e.keyCode == ARROW_LEFT)
                {
                    showPreviousImage();
                }
            }

            function init()
            {
                document.getElementById('files').addEventListener('change', onFilesSelected, false);
                gallery.element = document.getElementById('gallery');
                document.getElementById('fullscreen').addEventListener('click',
                    startFullscreen, false);
                document.addEventListener('keypress', onKeyPress, false);
            }

            init();
        </script>
    </body>
</html>
